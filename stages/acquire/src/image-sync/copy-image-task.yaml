version: v1.1.0
steps:
  # Step #1: Copy the image from the source registry to the destination registry
  - cmd: |
        bash -c 'echo "Copying image {{.Values.SOURCE_REGISTRY}}/{{.Values.SOURCE_REPOSITORY}}@{{.Values.SOURCE_IMAGE_DIGEST}} to {{.Run.Registry}}/{{.Values.SOURCE_REPOSITORY}}:{{.Values.SOURCE_IMAGE_TAG}}"'

  - id: oras-copy-image
    cmd: |                                                                  
        ghcr.io/oras-project/oras:v1.1.0 copy -r \
        {{.Values.SOURCE_REGISTRY}}/{{.Values.SOURCE_REPOSITORY}}@{{.Values.SOURCE_IMAGE_DIGEST}} \
        {{.Run.Registry}}/{{.Values.SOURCE_REPOSITORY}}:{{.Values.SOURCE_IMAGE_TAG}}
